<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Festa da Isabella</title>
<style>
  :root{
    --roxo:#5b3fa2; --roxo-esc:#493183; --roxo-cl:#f1eaff;
    --bg:#fdfdfe; --txt:#333; --muted:#666;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;background:var(--bg);color:var(--txt);line-height:1.5}
  a{color:var(--roxo);text-decoration:none}
  .container{max-width:960px;margin:0 auto;padding:20px}

  /* Hero */
  .hero{position:relative;background:url('hero.jpg') center/cover no-repeat;height:60vh;min-height:320px;display:flex;align-items:center;justify-content:center;color:#fff;text-align:center}
  .hero::before{content:"";position:absolute;inset:0;background:rgba(0,0,0,.25)}
  .hero h1{position:relative;font-size:2.5rem;margin-bottom:.4rem;font-weight:800;letter-spacing:-.02em}
  .hero p{position:relative;font-size:1.1rem;opacity:.95}

  /* Cards */
  .card{background:rgba(255,255,255,.85);backdrop-filter:blur(8px);border-radius:16px;padding:22px;margin:20px 0;box-shadow:0 4px 10px rgba(0,0,0,.06);text-align:center}
  .card h2{color:var(--roxo);font-weight:800;letter-spacing:-.02em;font-size:clamp(1.4rem,1.1rem + 1vw,1.9rem);margin-bottom:12px}
  .card p{margin:8px auto 0;max-width:62ch;color:#4a4a4a}
  .details-list{list-style:none;display:grid;grid-template-columns:1fr;gap:.6rem;justify-items:center}
  .details-item{display:flex;align-items:center;gap:.5rem;font-size:1.05rem;justify-content:center}
  .icon{display:inline-flex;align-items:center;justify-content:center;width:1.4em;height:1.4em;font-size:1.2rem;transform:translateY(1px);color:var(--roxo)}

  /* BotÃµes */
  .button-row{display:flex;flex-wrap:wrap;gap:14px;margin-top:16px;justify-content:center}
  .btn{display:inline-block;padding:13px 22px;border-radius:12px;font-weight:700;cursor:pointer;border:none;transition:.2s;letter-spacing:.01em;font-size:1rem}
  .btn-primary{background:var(--roxo);color:#fff}
  .btn-primary:hover{background:var(--roxo-esc)}
  .btn-secondary{background:var(--roxo-cl);color:var(--roxo)}
  .btn-secondary:hover{filter:brightness(.97)}
  .btn-lg{font-size:1.05rem;padding:15px 24px}

  /* Dois botÃµes lado a lado (e responsivo) */
  .button-row.duo{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
  @media (max-width:520px){ .button-row.duo{grid-template-columns:1fr} }

  /* Ãlbum */
  .album-preview{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;justify-items:center;margin:4px auto 12px}
  .album-preview .frame{position:relative;overflow:hidden;border-radius:14px;aspect-ratio:1/1;width:120px;box-shadow:0 6px 10px rgba(0,0,0,.08);transform:rotate(var(--tilt,0deg));transition:transform .5s ease}
  .album-preview img{width:100%;height:100%;object-fit:cover}

  /* Mapa + playlist */
  .map-container{width:100%;height:300px;border-radius:14px;overflow:hidden}
  iframe{width:100%;height:100%;border:0}
  .playlist-iframe{width:100%;max-width:600px;height:180px;border-radius:14px;border:0}

  /* Tempo */
  .weather-wrapper{display:flex;justify-content:center;margin:18px 0 90px}
  .weather-card{width:min(680px,92vw);padding:22px 18px;border-radius:16px;background:rgba(255,255,255,.85);backdrop-filter:blur(8px);box-shadow:0 4px 10px rgba(0,0,0,.06);text-align:center}
  .weather-app{color:var(--roxo);font-weight:800;letter-spacing:-.02em}
  .weather-date{margin-top:6px;color:#666}
  .weather-text{margin:12px auto 8px;max-width:60ch;color:#4a4a4a}
  .weather-source{margin-top:6px;font-size:.9rem;color:#7a7a7a}
  .weather-source a{color:var(--roxo)}

  /* Overlay de boasâ€‘vindas (mÃºsica) */
  .welcome-overlay{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px)}
  .welcome-card{width:min(92vw,520px);background:#fff;border-radius:18px;padding:28px;text-align:center;box-shadow:0 12px 28px rgba(0,0,0,.25)}
  .welcome-card h2{font-size:1.7rem;color:var(--roxo);margin-bottom:8px}

  /* Modais */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9998}
  .modal.open{display:flex}
  .modal-card{width:min(92vw,640px);background:#fff;border-radius:16px;padding:20px;box-shadow:0 12px 28px rgba(0,0,0,.25)}
  .modal-card h3{color:var(--roxo);font-size:1.4rem;margin-bottom:8px}
  .form-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px}
  .row{display:flex;gap:10px}
  .row>*{flex:1}
  label{font-weight:600;color:#444;font-size:.93rem;text-align:left}
  input,select,textarea{width:100%;margin-top:6px;border:1px solid #e6e2f5;border-radius:10px;padding:10px 12px;font-size:1rem}
  textarea{min-height:72px;resize:vertical}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:var(--roxo-cl);color:var(--roxo);padding:6px 10px;border-radius:999px;font-weight:700;font-size:.9rem;cursor:pointer;user-select:none}
  .chip.active{background:var(--roxo);color:#fff}
  .children{display:grid;gap:8px;margin-top:6px}
  .child-row{display:grid;grid-template-columns:2fr 1fr auto;gap:8px;align-items:end}
  .remove{background:#eee;border-radius:10px;padding:10px 12px;border:1px solid #ddd;cursor:pointer}
  .modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}

  /* Mural (layout anterior) */
  .mural-list{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px;min-height:48px}
  .mural-item{background:#fff;border:1px solid #eee;border-radius:12px;padding:12px 14px;color:#444;box-shadow:0 2px 6px rgba(0,0,0,.03);opacity:0;transform:translateY(6px);animation:fadeIn .5s forwards}
  @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}

  /* Marca dâ€™Ã¡gua */
  footer{position:fixed;bottom:20px;width:100%;text-align:center;font-size:12px;color:#999}
</style>
</head>
<body>

<!-- Overlay de boasâ€‘vindas -->
<div class="welcome-overlay" id="welcome">
  <div class="welcome-card">
    <h2>Bemâ€‘vindo(a) Ã  Festa da Isabella! ğŸ¶</h2>
    <p>Toque a mÃºsica para entrar no clima da celebraÃ§Ã£o.</p>
    <div class="button-row">
      <button class="btn btn-primary" id="start-music">Entrar e tocar playlist</button>
      <button class="btn btn-secondary" id="enter-silent">Entrar sem mÃºsica</button>
    </div>
  </div>
</div>

<header class="hero">
  <div>
    <h1>Festa da Isabella</h1>
    <p>Celebrando seu 1Âº aniversÃ¡rio</p>
  </div>
</header>

<main class="container">
  <!-- Boasâ€‘vindas -->
  <section class="card">
    <h2>Boasâ€‘vindas</h2>
    <p>Ã‰ com muita alegria que convidamos vocÃª para celebrar o 1Âº aniversÃ¡rio da nossa princesa Isabella! ğŸ‰ğŸ’–<br>
       SerÃ¡ um momento especial para reunirmos famÃ­lia e amigos, com muita diversÃ£o, mÃºsica e boas lembranÃ§as.<br>
       Esperamos vocÃª para comemorar conosco esse dia tÃ£o importante! ğŸ¥³âœ¨</p>
  </section>

  <!-- Mural (tÃ­tulo centralizado, lista e botÃ£o embaixo) -->
  <section class="card" id="mural-card">
    <h2>Mural ğŸ’Œ</h2>
    <div id="mural-list" class="mural-list">
      <div class="mural-item">Carregando mensagensâ€¦</div>
    </div>
    <div class="button-row">
      <button class="btn btn-primary" id="open-mural">Deixar mensagem ğŸ’Œ</button>
    </div>
  </section>

  <!-- InformaÃ§Ãµes -->
  <section class="card">
    <h2>InformaÃ§Ãµes da festa</h2>
    <ul class="details-list">
      <li class="details-item"><span class="icon">ğŸ“…</span>22 de novembro de 2025, 14h00â€“18h00</li>
      <li class="details-item">
        <span class="icon">ğŸ“</span>
        SÃ­tio Verdes Encantos â€“ Estr Zumbi dos Palmares, 286 - TinguÃ¡, Nova IguaÃ§u - RJ, 26063-355, Brasil
      </li>
      <li class="details-item"><span class="icon">ğŸ‘—</span>Traje: casual festivo</li>
    </ul>
    <div class="button-row duo">
      <button class="btn btn-primary btn-lg" id="confirmar-presenca">Confirmar presenÃ§a</button>
      <a class="btn btn-secondary btn-lg" href="festa_da_isabella.ics" download>Adicionar ao calendÃ¡rio</a>
    </div>
  </section>

  <!-- Ãlbum -->
  <section class="card">
    <h2>Ãlbum de fotos</h2>
    <div class="album-preview">
      <div class="frame"><img alt=""></div><div class="frame"><img alt=""></div><div class="frame"><img alt=""></div>
      <div class="frame"><img alt=""></div><div class="frame"><img alt=""></div><div class="frame"><img alt=""></div>
    </div>
    <div class="button-row" style="margin-top:8px">
      <a class="btn btn-secondary" target="_blank" rel="noopener"
         href="https://www.icloud.com/sharedalbum/#B2RJEsNWnGMlnHa">Abrir Ã¡lbum completo</a>
    </div>
  </section>

  <!-- Mapa -->
  <section class="card">
    <h2>Como chegar</h2>
    <div class="map-container">
      <iframe src="https://maps.google.com/maps?q=S%C3%ADtio%20Verdes%20Encantos%20-%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil&t=m&z=15&ie=UTF8&iwloc=&output=embed" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="button-row">
      <a class="btn btn-secondary"
         href="https://www.google.com/maps/dir/?api=1&destination=S%C3%ADtio%20Verdes%20Encantos%20-%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil"
         target="_blank" rel="noopener">TraÃ§ar rota</a>
      <a class="btn btn-secondary"
         href="https://www.google.com/maps/search/?api=1&query=S%C3%ADtio%20Verdes%20Encantos%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil"
         target="_blank" rel="noopener">Abrir no Google Maps</a>
    </div>
  </section>

  <!-- Presentes sugeridos (mantido no mesmo lugar) -->
  <section class="card">
    <h2>SugestÃ£o de presentes ğŸ’</h2>
    <ul class="details-list">
      <li class="details-item"><span class="icon">ğŸ§¸</span>Brinquedos educativos</li>
      <li class="details-item"><span class="icon">ğŸ‘—</span>Roupas tamanho 2 anos (cores suaves)</li>
      <li class="details-item"><span class="icon">ğŸ©°</span>CalÃ§ados a partir do tamanho 22</li>
    </ul>
    <div class="button-row">
      <a class="btn btn-secondary" target="_blank" rel="noopener"
         href="https://wa.me/5521993835163?text=Oi%2C%20tenho%20uma%20d%C3%BAvida%20sobre%20o%20presente%20da%20Isabella">
        DÃºvidas sobre o presente
      </a>
    </div>
  </section>

  <!-- Playlist (Apple) -->
  <section class="card" id="playlist-section">
    <h2>Playlist da festa</h2>
    <iframe class="playlist-iframe"
      allow="autoplay *; encrypted-media *; fullscreen *"
      sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
      src="https://embed.music.apple.com/br/playlist/playlist-festa-da-isabella/pl.u-MRjJtWNaq0M"
      title="Playlist da Festa"></iframe>
  </section>

  <!-- Tempo -->
  <section class="weather-wrapper">
    <div class="weather-card">
      <h2 class="weather-app">Tempo</h2>
      <div class="weather-date" id="weatherDate">â€”</div>
      <div class="weather-text" id="weatherText">Carregandoâ€¦</div>
      <div class="weather-source" id="weatherSource">Fonte: â€”</div>
    </div>
  </section>
</main>

<!-- Marca dâ€™Ã¡gua -->
<footer>Â© 2025 Hugo Mattos. Todos os direitos reservados.</footer>

<!-- Modal: Confirmar presenÃ§a -->
<div class="modal" id="modal-rsvp">
  <div class="modal-card">
    <h3>ConfirmaÃ§Ã£o de presenÃ§a âœ¨</h3>
    <p style="color:var(--muted)">Preencha seus dados. Ao enviar, abriremos o WhatsApp com a mensagem pronta.</p>
    <div class="form-grid">
      <div>
        <label>VocÃª vai?</label>
        <div class="chips" id="vai-chips">
          <div class="chip" data-vai="Sim">Sim</div>
          <div class="chip" data-vai="NÃ£o">NÃ£o</div>
        </div>
      </div>
      <div class="row">
        <div>
          <label>Seu nome*</label>
          <input id="nome" required placeholder="Seu nome"/>
        </div>
        <div>
          <label>Nome do(a) acompanhante</label>
          <input id="acompanhante" placeholder="Opcional"/>
        </div>
      </div>

      <div>
        <label>Filhos (nome e idade)</label>
        <div class="children" id="children"></div>
        <div class="button-row" style="justify-content:flex-start;margin-top:6px">
          <button class="btn btn-secondary" id="add-child" type="button">Adicionar filho</button>
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" id="close-rsvp" type="button">Cancelar</button>
      <button class="btn btn-primary" id="send-rsvp" type="button">Enviar pelo WhatsApp</button>
    </div>
  </div>
</div>

<!-- Modal: Deixar mensagem (Mural) -->
<div class="modal" id="modal-mural">
  <div class="modal-card">
    <h3>Deixar mensagem ğŸ’Œ</h3>
    <p style="color:var(--muted)">Escreva atÃ© 2 linhas. Se quiser, assine no final.</p>
    <div class="form-grid">
      <div>
        <label>Mensagem*</label>
        <textarea id="mural-text" maxlength="220" placeholder="Ex.: ParabÃ©ns, Isabella! Que Deus abenÃ§oe sua vida. â€” Seu nome"></textarea>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" id="close-mural" type="button">Cancelar</button>
      <button class="btn btn-primary" id="save-mural" type="button">Publicar</button>
    </div>
  </div>
</div>

<script>
/* ===== Supabase (MURAL) â€“ preencha com seus dados ===== */
const SUPABASE_URL = "YOUR_SUPABASE_URL";          // ex.: https://xxxx.supabase.co
const SUPABASE_ANON = "YOUR_SUPABASE_ANON_KEY";    // anon key
const MURAL_TABLE = "mural";

/* ===== MÃºsica (preview local) ===== */
const bgAudio = new Audio("assets/kids-children-baby-music-363272.mp3");
bgAudio.loop = true;
const welcome = document.getElementById('welcome');
document.getElementById('start-music')?.addEventListener('click', async () => {
  try { await bgAudio.play(); } catch(e){ console.warn(e); }
  welcome.style.display = 'none';
});
document.getElementById('enter-silent')?.addEventListener('click', ()=> welcome.style.display='none');

/* ===== Ãlbum ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  const previewImages = [
    'album2/IMG_5139.jpeg','album2/IMG_5010.jpeg','album2/IMG_4772.jpeg',
    'album2/IMG_4765.jpeg','album2/IMG_4639.jpeg','album2/IMG_6911.jpeg',
    'album2/IMG_4450.jpeg','album2/IMG_4352.jpeg','album2/IMG_3056.jpeg',
    'album2/96f8947a-603d-43c7-b498-292922662164.jpeg'
  ];
  const frames = document.querySelectorAll('.album-preview .frame');
  function shuffle(a){const b=a.slice();for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]]}return b;}
  function fillPreview(){
    const imgs = shuffle(previewImages);
    frames.forEach((frame, idx) => {
      const img = frame.querySelector('img');
      img.src = imgs[idx % imgs.length];
      frame.style.setProperty('--tilt', (Math.random()*10-5)+'deg');
    });
  }
  fillPreview();
  setInterval(fillPreview, 8000);
});

/* ===== Tempo (Openâ€‘Meteo) ===== */
(function(){
  const EVENT_DATE_DEFAULT='2025-11-22', LAT=-22.606, LON=-43.490, TZ='America/Sao_Paulo';
  const qs=new URLSearchParams(location.search);
  const EVENT_DATE=qs.get('data')||EVENT_DATE_DEFAULT;
  const fmtDate=(iso)=>new Intl.DateTimeFormat('pt-BR',{day:'2-digit',month:'long'}).format(new Date(iso+'T12:00:00'));
  document.getElementById('weatherDate').textContent=fmtDate(EVENT_DATE);
  const daysTo=(iso)=>{const t=new Date();t.setHours(0,0,0,0);return Math.round((new Date(iso+'T00:00:00')-t)/86400000)}
  const elT=document.getElementById('weatherText'), elS=document.getElementById('weatherSource');
  const stamp=(src)=>{const now=new Intl.DateTimeFormat('pt-BR',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit',timeZone:TZ}).format(new Date()).replace('.','');elS.innerHTML=`Fonte: <a href="https://open-meteo.com/" target="_blank" rel="noopener">${src}</a> â€¢ Atualizado em ${now} (BRT)`;}
  async function forecast(){const u=new URL('https://api.open-meteo.com/v1/forecast');u.search=new URLSearchParams({latitude:LAT,longitude:LON,timezone:TZ,daily:'temperature_2m_max,temperature_2m_min,precipitation_probability_mean',start_date:EVENT_DATE,end_date:EVENT_DATE});return (await fetch(u)).json();}
  async function climate(month){const u=new URL('https://climate-api.open-meteo.com/v1/climate');u.search=new URLSearchParams({latitude:LAT,longitude:LON,start_year:1991,end_year:2020,models:'ERA5',monthly:'temperature_2m_max_mean,temperature_2m_min_mean,precipitation_probability_mean',month:month});return (await fetch(u)).json();}
  (async()=>{
    try{
      if(daysTo(EVENT_DATE)>=0 && daysTo(EVENT_DATE)<=16){
        const d=(await forecast()).daily; const tmax=Math.round(d.temperature_2m_max[0]), tmin=Math.round(d.temperature_2m_min[0]), p=d.precipitation_probability_mean?.[0];
        elT.textContent = (typeof p==='number')?`PrevisÃ£o: entre ${tmin}Â° e ${tmax}Â°, chance de chuva ${p}%`:`PrevisÃ£o: entre ${tmin}Â° e ${tmax}Â°`;
        stamp('Openâ€‘Meteo (previsÃ£o diÃ¡ria)');
      }else{
        const m=(await climate(Number(EVENT_DATE.split('-')[1]))).monthly||{};
        const tmax=Math.round(m.temperature_2m_max_mean?.[0]??27), tmin=Math.round(m.temperature_2m_min_mean?.[0]??20);
        elT.textContent=`Nesta Ã©poca do ano, a temperatura costuma variar entre ${tmin}Â° e ${tmax}Â°.`;
        stamp('Openâ€‘Meteo (climatologia 1991â€“2020)');
      }
    }catch(e){ elT.textContent='Nesta Ã©poca do ano, a temperatura varia entre 20Â° e 27Â°.'; stamp('Openâ€‘Meteo'); }
  })();
})();

/* ===== RSVP (WhatsApp) ===== */
const modalRSVP = document.getElementById('modal-rsvp');
document.getElementById('confirmar-presenca')?.addEventListener('click',()=>modalRSVP.classList.add('open'));
document.getElementById('close-rsvp')?.addEventListener('click',()=>modalRSVP.classList.remove('open'));

const chips = document.getElementById('vai-chips');
let vaiValue = '';
chips.querySelectorAll('.chip').forEach(ch=>{
  ch.addEventListener('click',()=>{
    chips.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
    ch.classList.add('active'); vaiValue = ch.dataset.vai;
  });
});

const childrenBox = document.getElementById('children');
document.getElementById('add-child')?.addEventListener('click',()=>{
  const row = document.createElement('div');
  row.className='child-row';
  row.innerHTML = `
    <div><label>Nome</label><input class="c-nome" placeholder="Ex.: Miguel"></div>
    <div><label>Idade</label><input class="c-idade" type="number" min="0" max="18" placeholder="2"></div>
    <button class="remove" type="button">Remover</button>
  `;
  row.querySelector('.remove').onclick = ()=>row.remove();
  childrenBox.appendChild(row);
});

document.getElementById('send-rsvp')?.addEventListener('click',()=>{
  const nome = document.getElementById('nome').value.trim();
  const acomp = document.getElementById('acompanhante').value.trim();
  if(!nome){ alert('Informe seu nome.'); return; }
  if(!vaiValue){ alert('Selecione se vocÃª vai ou nÃ£o.'); return; }

  const filhos = [];
  childrenBox.querySelectorAll('.child-row').forEach(r=>{
    const n = r.querySelector('.c-nome').value.trim();
    const i = r.querySelector('.c-idade').value.trim();
    if(n || i) filhos.push(`${n||'Filho(a)'} - ${i||'?'} anos`);
  });

  let msg = `ConfirmaÃ§Ã£o de presenÃ§a â€“ Festa da Isabella%0A`;
  msg += `Vai: ${vaiValue}%0A`;
  msg += `Nome: ${encodeURIComponent(nome)}%0A`;
  if(acomp) msg += `Acompanhante: ${encodeURIComponent(acomp)}%0A`;
  if(filhos.length) msg += `Filhos:%0A- ${encodeURIComponent(filhos.join('%0A- '))}%0A`;

  const wa = `https://wa.me/5521993835163?text=${msg}`;
  window.open(wa, '_blank', 'noopener');
  modalRSVP.classList.remove('open');
});

/* ===== Mural (Supabase) ===== */
async function sbFetch(path, opts={}){
  const r = await fetch(`${SUPABASE_URL}/rest/v1/${path}`, {
    ...opts,
    headers:{
      apikey: SUPABASE_ANON,
      Authorization: `Bearer ${SUPABASE_ANON}`,
      'Content-Type':'application/json',
      ...opts.headers
    }
  });
  if(!r.ok){
    const txt = await r.text().catch(()=>String(r.status));
    throw new Error(txt || `HTTP ${r.status}`);
  }
  return r.json();
}

const listEl = document.getElementById('mural-list');
const exemplos = [
  "ParabÃ©ns, Isabella! Muita saÃºde e alegria! â€” FamÃ­lia Silva",
  "Que seu dia seja tÃ£o doce quanto o seu sorriso! ğŸ’œ â€” Tia Ana",
  "Feliz 1Âº aninho! Deus abenÃ§oe sempre! â€” Pedro & Lu",
  "Estamos muito felizes por celebrar com vocÃªs! â€” JoÃ£o e Maria"
];

async function loadMural(){
  try{
    const rows = await sbFetch(`${MURAL_TABLE}?select=message,created_at&order=created_at.desc&limit=20`);
    renderList(rows.length ? rows.map(r=>r.message) : exemplos);
  }catch(e){
    console.warn('Mural load error:', e);
    renderList(exemplos);
  }
}

function renderList(messages){
  listEl.innerHTML = '';
  messages.forEach((m,i)=>{
    const div = document.createElement('div');
    div.className='mural-item';
    div.style.animationDelay = (i*0.06)+'s';
    div.textContent = m;
    listEl.appendChild(div);
  });
}

loadMural();

/* Publicar mensagem */
const modalMural = document.getElementById('modal-mural');
document.getElementById('open-mural')?.addEventListener('click',()=>modalMural.classList.add('open'));
document.getElementById('close-mural')?.addEventListener('click',()=>modalMural.classList.remove('open'));

document.getElementById('save-mural')?.addEventListener('click', async ()=>{
  const txt = document.getElementById('mural-text').value.trim();
  if(!txt){ alert('Escreva sua mensagem.'); return; }

  // Optimistic UI: mostra jÃ¡ na tela
  const temp = document.createElement('div');
  temp.className='mural-item';
  temp.textContent = txt;
  listEl.prepend(temp);

  try{
    await sbFetch(MURAL_TABLE, { method:'POST', body: JSON.stringify([{ message: txt }]) });
    document.getElementById('mural-text').value = '';
    modalMural.classList.remove('open');
  }catch(e){
    alert('NÃ£o foi possÃ­vel publicar agora.\n\nDica: verifique no Supabase se a tabela "mural" tem policies de SELECT e INSERT liberadas para o anon.\n\nDetalhes: ' + e.message);
  }
});
</script>
</body>
</html>
