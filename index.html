<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Festa da Isabella</title>

  <!-- Cor da UI -->
  <meta name="theme-color" content="#db2777"/>

  <!-- Atalho em iPhone/Android -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Festa da Isabella">
  <link rel="icon" type="image/png" href="logo/imageapp.png">
  <link rel="apple-touch-icon" href="logo/imageapp.png">

  <!-- Social preview (opcional) -->
  <meta property="og:title" content="Festa da Isabella">
  <meta property="og:description" content="Celebra√ß√£o do 1¬∫ anivers√°rio da Isabella.">
  <meta property="og:image" content="logo/imageapp.png">
  <meta property="og:type" content="website">

  <style>
  :root{
    /* Paleta rosa claro */
    --roxo:#db2777;      /* principal */
    --roxo-esc:#be185d;  /* hover/destaque escuro */
    --roxo-cl:#ffe4f1;   /* fundos suaves / chips */

    --bg:#f7f7fb;--txt:#262626;--muted:#6b7280;--white:#fff;
    --shadow:0 10px 25px rgba(17,17,17,.08);
    --radius:14px;
    --p:0;
    --zoom: calc(8% * (1 - var(--p)));
  }
  *{box-sizing:border-box} html,body{margin:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;color:var(--txt);line-height:1.55;background:var(--bg)}
  a{color:var(--roxo);text-decoration:none}
  .container{max-width:980px;margin:0 auto;padding:22px 16px}

  /* ===== Fundo cont√≠nuo 100% DESFOCADO atr√°s dos cards ===== */
  .page-bg{
    position:fixed; inset:0; z-index:-2;
    background:url('hero.jpg') center/cover no-repeat;
    background-size: calc(100% + var(--zoom)) auto;
    filter: blur(20px) saturate(105%);
    transform: scale(1.05);
  }
  .page-bg::after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(to bottom,
      rgba(247,247,251,0) 0%,
      rgba(247,247,251,.65) 40vh,
      rgba(247,247,251,1) 65vh);
  }

  /* ===== Hero ===== */
  .hero{
    height:58vh; min-height:340px; position:relative; overflow:hidden;
    display:flex; align-items:flex-end; justify-content:center; text-align:center;
    background:url('hero.jpg') center/cover no-repeat;
    background-size: calc(100% + var(--zoom)) auto;
  }
  .hero::before{
    content:""; position:absolute; inset:0;
    background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,.12));
    pointer-events:none;
  }
  .hero-inner{position:relative;width:100%;height:100%;display:flex;align-items:flex-end;justify-content:center}
  .hero-glow{
    position:absolute; left:0; right:0; bottom:0; height:40%;
    background:linear-gradient(to bottom, rgba(255,255,255,0) 0%,
                                          rgba(255,255,255,.25) 35%,
                                          rgba(247,247,251,1) 100%);
    backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
    opacity: calc(.6 + .4 * var(--p));
    pointer-events:none;
  }
  .hero-title{position:relative; z-index:1; padding-bottom:22px;
    transform: translateY(calc(12px * (1 - var(--p))));
    transition: transform .2s ease-out;
  }
  .hero h1{
    color:#fff; margin:0 0 6px;
    font-size:clamp(36px,6vw,56px); font-weight:800; letter-spacing:-.02em;
    text-shadow:0 6px 20px rgba(0,0,0,.45);
  }
  .hero p{
    color:#fff; margin:0 0 24px; font-weight:500; font-size:clamp(16px,2.3vw,20px);
    text-shadow:0 4px 14px rgba(0,0,0,.35);
  }

  /* ===== Cards ===== */
  .card{
    background:rgba(255,255,255,0.68);
    backdrop-filter: saturate(125%);
    -webkit-backdrop-filter: saturate(125%);
    border:1px solid rgba(255,255,255,.5);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:20px; margin:18px auto;
  }
  .card h2{margin:0 0 10px;color:var(--roxo);font-size:clamp(22px,2.6vw,30px);letter-spacing:-.02em}
  .card p{margin:6px 0;color:#3b3b3b}
  .center{text-align:center}

  /* Details list */
  .details{list-style:none;padding:0;margin:0;display:grid;gap:.6rem;justify-items:center}
  .details li{display:flex;gap:.55rem;align-items:center;justify-content:center;text-align:center}
  .icon{color:var(--roxo);font-size:1.1rem;transform:translateY(1px)}

  /* Bot√µes */
  .btn{appearance:none;border:0;border-radius:10px;padding:12px 18px;font-weight:700;cursor:pointer;font-size:16px;line-height:1}
  .btn-primary{background:var(--roxo);color:#fff}
  .btn-primary:hover{background:var(--roxo-esc)}
  .btn-soft{background:var(--roxo-cl);color:var(--roxo)}
  .btn-ghost{background:#f4f4f8;color:#333}
  .row{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:14px}
  .row .btn{min-width:240px}
  @media(min-width:720px){ .row.row-2 .btn{min-width:260px} }

  /* √Ålbum */
  .album{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;justify-items:center}
  .frame{width:120px;aspect-ratio:1;border-radius:12px;overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.08);transform:rotate(var(--tilt,0deg))}
  .frame img{width:100%;height:100%;object-fit:cover;display:block}

  /* Iframes */
  .map{width:100%;height:300px;border:0;border-radius:12px;overflow:hidden}
  .apple-embed{width:100%;max-width:680px;height:260px;border:0;border-radius:12px}

  /* ======== Tempo (card clean, menor, n√∫meros com sombra) ======== */
  .weather{max-width:700px;margin:0 auto}
  #weatherText{
    display:flex; align-items:center; justify-content:center; gap:10px;
    font-size:1rem; font-weight:600; color:var(--txt);
  }
  .temp-highlight{ color:var(--roxo); font-weight:700; letter-spacing:.01em; }
  .temp-highlight .num{
    font-weight:800;
    text-shadow:0 1px 4px rgba(0,0,0,.22);
  }
  .wx-emoji{ font-size:1.25rem; line-height:1; transform:translateY(1px) }
  #weatherDate{ color:var(--muted); }
  #weatherSource{ color:var(--muted); font-size:12px; line-height:1.4; }

  /* Overlay m√∫sica */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:9999}
  .overlay.hide{display:none}
  .welcome{background:#fff;width:min(92vw,520px);border-radius:16px;padding:24px 20px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.25)}
  .welcome h3{margin:0 0 8px;color:var(--roxo);font-size:clamp(22px,2.6vw,28px)}
  .welcome p{color:#444;margin:0 0 16px}

  /* ===== Modal ‚Äúde vidro‚Äù ===== */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:9998}
  .modal.open{display:flex}
  .modal-card{
    background:rgba(255,255,255,0.95);
    backdrop-filter:saturate(125%);
    -webkit-backdrop-filter:saturate(125%);
    border:1px solid rgba(255,255,255,.9);
    border-radius:16px;width:min(92vw,620px);max-height:88vh;overflow:auto;
    padding:22px;box-shadow:0 20px 60px rgba(0,0,0,.25);
    text-align:center;
  }
  .modal-header{display:flex;align-items:center;justify-content:center;margin-bottom:10px;position:relative}
  .modal-title{font-size:22px;color:var(--roxo);font-weight:800;letter-spacing:-.02em}
  .close{position:absolute;right:8px;top:0;background:#f2effd;border:0;color:var(--roxo);width:36px;height:36px;border-radius:9px;font-size:18px;cursor:pointer}

  /* Form */
  .field{margin:10px 0}
  .label{display:block;margin:0 0 6px;font-weight:700}
  .input,.textarea,select{
    width:100%;border:2px solid #ece9ff;background:#f7f5ff;border-radius:10px;
    padding:12px 12px;font:inherit;text-align:center;
  }
  .textarea{min-height:96px;resize:vertical}

  /* RSVP */
  .yn{display:flex;gap:10px;justify-content:center}
  .yn .opt{flex:1;border-radius:10px;border:2px solid #ece9ff;background:#f7f5ff;padding:10px 12px;text-align:center;font-weight:700;cursor:pointer}
  .yn .opt.active{background:var(--roxo);color:#fff;border-color:var(--roxo)}
  .hide{display:none}

  /* Mural */
  .mural-box{min-height:66px;display:flex;align-items:center;justify-content:center;padding:12px;border-radius:12px;background:#faf8ff;color:#4a4a4a}
  .mural-msg{font-size:1.05rem;text-align:center;transition:opacity .6s ease, transform .6s ease}
  .fade-out{opacity:0;transform:translateY(8px)}
  .fade-in{opacity:1;transform:translateY(0)}
  .muted{color:var(--muted);font-size:.95rem}

  /* Marca d‚Äô√°gua fixa */
  footer.watermark{
    position:fixed;left:0;right:0;bottom:4px;
    text-align:center;font-size:12px;color:#9aa0a6;opacity:.9;
    pointer-events:none;
  }

  body.modal-open{overflow:hidden}

  /* ===== Countdown ===== */
  .countdown{ display:grid; gap:14px; justify-items:center; }
  .cd-title{ margin:0; color:var(--roxo); font-weight:800; letter-spacing:-.02em }
  .cd-grid{ display:flex; align-items:center; justify-content:center; gap:10px; }
  .cd-sep{ font-weight:800; font-size:clamp(22px,5vw,32px); color:var(--roxo); transform:translateY(-2px); opacity:.95; }
  .cd-unit{ display:flex; flex-direction:column; align-items:center; gap:6px; }
  .cd-box{ min-width:72px; padding:10px 12px; border-radius:12px; background:#fff; border:1px solid var(--roxo-cl); box-shadow:0 6px 18px rgba(219,39,119,.16); text-align:center; }
  .cd-num{ font-weight:800; letter-spacing:.04em; font-size:clamp(22px,6vw,34px); color:var(--roxo); }
  .cd-label{ font-size:.85rem; color:#8b8fa0; font-weight:700; }
  @media (max-width:420px){ .cd-box{ min-width:64px; padding:8px 10px; } .cd-label{ font-size:.8rem; } }

  /* ===== Melhorias para Desktop e Ultrawide ===== */
  @media (min-width: 900px) {
    .container { max-width: 1100px; padding: 28px 20px; }

    .hero { height: 62vh; min-height: 520px; background-position: center 35%; }
    .hero h1 { font-size: clamp(40px, 5.2vw, 64px); }
    .hero p  { font-size: clamp(18px, 2vw, 22px); }

    .card { padding: 26px; margin: 22px auto; }

    .album { grid-template-columns: repeat(4, 1fr); gap: 14px; }
    .frame { width: 150px; border-radius: 14px; }

    .row .btn { min-width: 220px; }

    .map { height: 380px; }
    .apple-embed { height: 320px; }

    .cd-box { min-width: 84px; padding: 12px 14px; }
    .cd-num { font-size: clamp(28px, 3.2vw, 40px); }
  }

  @media (min-width: 1280px) {
    .container { max-width: 1240px; }

    .hero { height: 66vh; min-height: 600px; }

    .album { grid-template-columns: repeat(5, 1fr); gap: 16px; }
    .frame { width: 180px; }

    .map { height: 440px; }
    .apple-embed { height: 360px; }
  }

  @media (min-width: 1600px) {
    .container { max-width: 1320px; }
    .frame { width: 200px; }
  }
  </style>
</head>
<body>

<!-- Fundo cont√≠nuo (emba√ßado) sob os cards -->
<div class="page-bg" aria-hidden="true"></div>

<!-- Overlay Boas-vindas (MP3) -->
<div id="welcome-overlay" class="overlay">
  <div class="welcome">
    <h3>Bem-vind(o/a) √† Festa da Isabella! üé∂</h3>
    <p>Toque a m√∫sica para entrar no clima da celebra√ß√£o.</p>
    <div class="row">
      <button id="start-music" class="btn btn-primary">Entrar e tocar playlist</button>
      <button id="enter-silent" class="btn btn-soft">Entrar sem m√∫sica</button>
    </div>
  </div>
</div>

<!-- Player escondido -->
<audio id="bg-audio" preload="auto" playsinline webkit-playsinline crossorigin="anonymous"></audio>

<!-- HERO -->
<header class="hero">
  <div class="hero-inner">
    <div class="hero-glow"></div>
    <div class="hero-title">
      <h1>Festa da Isabella</h1>
      <p>Celebrando seu 1¬∫ anivers√°rio</p>
    </div>
  </div>
</header>

<main class="container">

  <!-- 1) Boas-vindas -->
  <section class="card center" id="boas-vindas">
    <h2>Boas-vindas</h2>
    <p>√â com muita alegria que convidamos voc√™ para celebrar o 1¬∫ anivers√°rio da nossa princesa Isabella! üéâüíñ</p>
    <p>Ser√° um momento especial para reunirmos fam√≠lia e amigos, com muita divers√£o, m√∫sica e boas lembran√ßas.</p>
    <p>Esperamos voc√™ para comemorar conosco esse dia t√£o importante! ü•≥‚ú®</p>
  </section>

  <!-- 2) Contagem regressiva -->
  <section class="card center" id="countdown-card">
    <h2 id="cd-status" class="cd-title">Falta pouco! üéâ</h2>
    <div class="countdown" aria-live="polite">
      <div class="cd-grid">
        <div class="cd-unit">
          <div class="cd-box"><span id="cd-months" class="cd-num">00</span></div>
          <div class="cd-label">meses</div>
        </div>
        <div class="cd-sep">:</div>
        <div class="cd-unit">
          <div class="cd-box"><span id="cd-days" class="cd-num">00</span></div>
          <div class="cd-label">dias</div>
        </div>
        <div class="cd-sep">:</div>
        <div class="cd-unit">
          <div class="cd-box"><span id="cd-hours" class="cd-num">00</span></div>
          <div class="cd-label">horas</div>
        </div>
      </div>
    </div>
  </section>

  <!-- 3) Informa√ß√µes -->
  <section class="card center">
    <h2>Informa√ß√µes da festa</h2>
    <ul class="details">
      <li><span class="icon">üìÖ</span>16 de novembro de 2025, 10h30‚Äì15h00</li>
      <li><span class="icon">üìç</span>S√≠tio Verdes Encantos ‚Äì Estr Zumbi dos Palmares, 286 - Tingu√°, Nova Igua√ßu - RJ, 26063-355, Brasil</li>
      <!-- AQUI: linha do traje alterada -->
      <li><span class="icon">üëó</span>Traje: casual festivo (piscina liberada ‚Äî leve traje de banho e toalha, se quiser aproveitar)</li>
    </ul>
    <div class="row row-2">
      <button id="open-rsvp" class="btn btn-primary">Confirmar presen√ßa</button>
      <a class="btn btn-soft" href="festa_da_isabella.ics" download>Adicionar ao calend√°rio</a>
    </div>
  </section>

  <!-- 4) Como chegar -->
  <section class="card center">
    <h2>Como chegar</h2>
    <iframe class="map" loading="lazy" allowfullscreen
      src="https://maps.google.com/maps?q=S%C3%ADtio%20Verdes%20Encantos%20-%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil&t=m&z=15&ie=UTF8&iwloc=&output=embed"></iframe>
    <div class="row">
      <a class="btn btn-soft" target="_blank" rel="noopener"
        href="https://www.google.com/maps/dir/?api=1&destination=S%C3%ADtio%20Verdes%20Encantos%20-%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil">Tra√ßar rota</a>
      <a class="btn btn-soft" target="_blank" rel="noopener"
        href="https://www.google.com/maps/search/?api=1&query=S%C3%ADtio%20Verdes%20Encantos%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil">Abrir no Google Maps</a>
    </div>
  </section>

  <!-- 5) Mural -->
  <section class="card center" id="mural-card">
    <h2>Mural üíå</h2>
    <div class="mural-box">
      <div id="muralMessage" class="mural-msg muted">Carregando‚Ä¶</div>
    </div>
    <div class="row">
      <button id="open-mural" class="btn btn-primary">Deixar mensagem üíå</button>
    </div>
  </section>

  <!-- 6) √Ålbum -->
  <section class="card center">
    <h2>√Ålbum de fotos</h2>
    <div class="album" id="albumPreview">
      <div class="frame"><img alt=""></div>
      <div class="frame"><img alt=""></div>
      <div class="frame"><img alt=""></div>
      <div class="frame"><img alt=""></div>
      <div class="frame"><img alt=""></div>
      <div class="frame"><img alt=""></div>
    </div>
    <div class="row">
      <a class="btn btn-soft" href="https://www.icloud.com/sharedalbum/#B2RJEsNWnGMlnHa" target="_blank" rel="noopener">Abrir √°lbum completo</a>
    </div>
  </section>

  <!-- 7) Presentes -->
  <section class="card center">
    <h2>Sugest√£o de presentes üíù</h2>
    <ul class="details">
      <li><span class="icon">üß∏</span>Brinquedos educativos</li>
      <li><span class="icon">üëó</span>Roupas tamanho 2 anos (cores suaves)</li>
      <li><span class="icon">ü©∞</span>Cal√ßados a partir do tamanho 22</li>
    </ul>
    <div class="row">
      <a class="btn btn-soft" target="_blank" rel="noopener"
        href="https://wa.me/5521993835163?text=Oi%2C%20tenho%20uma%20d%C3%BAvida%20sobre%20o%20presente%20da%20Isabella">D√∫vidas sobre o presente</a>
    </div>
  </section>

  <!-- 8) Playlist Apple Music -->
  <section class="card center">
    <h2>Playlist da festa</h2>
    <iframe class="apple-embed"
      allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write"
      sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation"
      src="https://embed.music.apple.com/br/playlist/playlist-festa-da-isabella/pl.u-MRjJtWNaq0M"></iframe>
  </section>

  <!-- 9) Tempo -->
  <section class="card weather center">
    <h2>Tempo</h2>
    <div id="weatherDate" class="muted" style="margin-bottom:6px">‚Äî</div>
    <p id="weatherText">Carregando‚Ä¶</p>
    <p id="weatherSource" class="muted">Fonte: ‚Äî</p>
  </section>

</main>

<footer class="watermark">¬© 2025 Hugo Mattos. Todos os direitos reservados.</footer>

<!-- Modal MURAL -->
<div id="modal-mural" class="modal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">Deixar mensagem üíå</div>
      <button class="close" data-close="modal-mural">‚úï</button>
    </div>
    <div class="field">
      <label class="label" for="mural-input">Mensagem *</label>
      <textarea id="mural-input" maxlength="140" class="textarea" placeholder="M√°x. 140 caracteres. Se quiser, assine no final (ex.: ‚Äî Fam√≠lia Silva)."></textarea>
    </div>
    <div class="row">
      <button id="mural-send" class="btn btn-primary">Publicar</button>
      <button class="btn btn-ghost" data-close="modal-mural">Cancelar</button>
    </div>
    <div id="mural-error" class="muted" style="margin-top:10px;display:none">N√£o foi poss√≠vel publicar agora. Tente de novo.</div>
  </div>
</div>

<!-- Modal RSVP -->
<div id="modal-rsvp" class="modal" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">Confirma√ß√£o de presen√ßa ‚ú®</div>
      <button class="close" data-close="modal-rsvp">‚úï</button>
    </div>

    <p class="muted" style="margin:0 0 10px">Preencha seus dados e envie ‚Äî abriremos o WhatsApp com a mensagem pronta.</p>

    <div class="field">
      <label class="label" for="rsvp-nome">Seu nome *</label>
      <input id="rsvp-nome" class="input" placeholder="Nome completo" />
    </div>

    <div class="field">
      <span class="label">Voc√™ vai?</span>
      <div class="yn" id="yn">
        <div data-val="sim" class="opt">Sim</div>
        <div data-val="nao" class="opt">N√£o</div>
      </div>
    </div>

    <div id="rsvp-extra" class="hide">
      <div class="field">
        <label class="label" for="rsvp-acompanha">Acompanhante</label>
        <input id="rsvp-acompanha" class="input" placeholder="Nome do(a) acompanhante (se houver)" />
      </div>
      <div class="field">
        <label class="label" for="rsvp-qtd">Qtd. filhos</label>
        <input id="rsvp-qtd" class="input" type="number" min="0" step="1" value="0"/>
      </div>
      <div class="field">
        <label class="label" for="rsvp-idades">Idades dos filhos</label>
        <input id="rsvp-idades" class="input" placeholder="Ex.: 5, 2"/>
      </div>
    </div>

    <div class="row">
      <button id="rsvp-send" class="btn btn-primary">Enviar</button>
      <button class="btn btn-ghost" data-close="modal-rsvp">Cancelar</button>
    </div>
  </div>
</div>

<script>
/* ---------- Overlay m√∫sica (robusto) ---------- */
(function(){
  const WELCOME_KEY = 'welcomeDone_v2';
  const overlay   = document.getElementById('welcome-overlay');
  const btnPlay   = document.getElementById('start-music');
  const btnSilent = document.getElementById('enter-silent');
  const audio     = document.getElementById('bg-audio');

  const mp3Path = 'assets/kids-children-baby-music-363272.mp3';
  audio.loop = true;
  audio.volume = 0.9;
  audio.src = mp3Path + '?v=' + Date.now();

  const done = sessionStorage.getItem(WELCOME_KEY) === '1';
  if (done) { overlay.classList.add('hide'); } else { document.body.classList.add('modal-open'); }

  function finishWelcome() {
    overlay.classList.add('hide');
    document.body.classList.remove('modal-open');
    sessionStorage.setItem(WELCOME_KEY,'1');
  }

  async function tryPlay() {
    try { audio.load(); await audio.play(); return true; }
    catch (e) { console.warn('Falha ao tocar √°udio:', e?.message || e); return false; }
  }

  btnPlay?.addEventListener('click', async () => {
    const ok = await tryPlay(); finishWelcome();
    if (!ok) {
      const onceClick = async () => { await tryPlay(); document.removeEventListener('click', onceClick, true); document.removeEventListener('touchend', onceClick, true); };
      document.addEventListener('click', onceClick, true);
      document.addEventListener('touchend', onceClick, true);
    }
  });

  btnSilent?.addEventListener('click', finishWelcome);

  const globalFirstTap = async () => {
    if (overlay.classList.contains('hide')) return;
    const ok = await tryPlay();
    if (ok) finishWelcome();
    document.removeEventListener('click', globalFirstTap, true);
    document.removeEventListener('touchend', globalFirstTap, true);
  };
  document.addEventListener('click', globalFirstTap, true);
  document.addEventListener('touchend', globalFirstTap, true);
})();

/* ---------- Efeito lock-screen ---------- */
(function(){
  function onScroll(){
    const hero = document.querySelector('.hero');
    if(!hero) return;
    const H = hero.offsetHeight;
    const y = Math.min(H, Math.max(0, window.scrollY));
    const p = y / H;
    document.documentElement.style.setProperty('--p', p.toFixed(3));
  }
  onScroll();
  window.addEventListener('scroll', onScroll, {passive:true});
  window.addEventListener('resize', onScroll);
})();

/* ---------- √Ålbum aleat√≥rio ---------- */
(function(){
  const srcs = [
    'album2/IMG_5139.jpeg','album2/IMG_5010.jpeg','album2/IMG_4772.jpeg',
    'album2/IMG_4765.jpeg','album2/IMG_4639.jpeg','album2/IMG_6911.jpeg',
    'album2/IMG_4450.jpeg','album2/IMG_4352.jpeg','album2/IMG_3056.jpeg',
    'album2/96f8947a-603d-43c7-b498-292922662164.jpeg'
  ];
  const frames = document.querySelectorAll('.frame img');
  const shuf = a=>a.slice().sort(()=>Math.random()-0.5);
  function fill(){
    const imgs = shuf(srcs);
    frames.forEach((img,i)=>{
      img.src = imgs[i%imgs.length];
      img.parentElement.style.setProperty('--tilt', (Math.random()*10-5)+'deg');
    });
  }
  fill(); setInterval(fill, 8000);
})();

/* ---------- Supabase (Mural) ‚Äî usa apenas 'mensagem' ---------- */
const SUPABASE_URL  = "https://kfoousycrqscvhivhmxu.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtmb291c3ljcnFzY3ZoaXZobXh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMDI1MTcsImV4cCI6MjA3MDY3ODUxN30.e55uMlW4mBmQjvG0U9WaEyqLPvjL9US3LP_9IvNTLVQ";

let supabaseClient = null;
let supaReady = false;
const muralBox = document.getElementById('muralMessage');

(function loadSupabase(){
  const s = document.createElement('script');
  s.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js";
  s.async = true;
  s.onload = initSupabase;
  s.onerror = () => showError("Falha ao carregar a biblioteca do Supabase.");
  document.head.appendChild(s);
})();

function showError(msg, details){
  muralBox.textContent = msg + (details ? ` (${details})` : "");
  muralBox.classList.add('muted');
}

function initSupabase(){
  try{
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON, { auth:{persistSession:false} });
    supaReady = true;
    loadMural();

    try{
      supabaseClient.channel('public:messages')
        .on('postgres_changes',{event:'INSERT',schema:'public',table:'messages'}, ()=>loadMural(true))
        .subscribe();
    }catch(e){}
  }catch(e){
    showError("N√£o foi poss√≠vel iniciar o mural.", e?.message);
  }
}

async function loadMural(isRealtime=false){
  if(!supaReady) return;
  try{
    let { data, error } = await supabaseClient
      .from('messages')
      .select('mensagem, created_at')
      .order('created_at',{ascending:false})
      .limit(12);

    if(error && error.code === '42703'){
      ({ data, error } = await supabaseClient
        .from('messages')
        .select('mensagem, inserted_at')
        .order('inserted_at',{ascending:false})
        .limit(12));
    }
    if(error){
      ({ data, error } = await supabaseClient
        .from('messages')
        .select('mensagem')
        .limit(12));
    }
    if(error) throw error;

    const list = (data||[]).map(r => r.mensagem ?? "").filter(Boolean);

    if(!list.length){
      muralBox.textContent = "Seja o primeiro a deixar um recado üíú";
      muralBox.classList.remove('muted');
      clearInterval(window._muralTimer);
      return;
    }

    muralBox.classList.remove('muted');
    let i = 0;
    const show = (idx)=>{
      muralBox.classList.add('fade-out');
      setTimeout(()=>{
        muralBox.textContent = list[idx];
        muralBox.classList.remove('fade-out');
        muralBox.classList.add('fade-in');
        setTimeout(()=>muralBox.classList.remove('fade-in'), 600);
      },300);
    };
    show(0);

    if(!isRealtime){
      clearInterval(window._muralTimer);
      window._muralTimer = setInterval(()=>{ i=(i+1)%list.length; show(i); }, 4000);
    }
  }catch(e){
    showError("N√£o foi poss√≠vel carregar as mensagens agora.", e?.message || e);
  }
}

/* ---------- Modais ---------- */
function openModal(id){ document.getElementById(id).classList.add('open'); document.body.classList.add('modal-open'); }
function closeModal(id){ document.getElementById(id).classList.remove('open'); document.body.classList.remove('modal-open'); }
document.querySelectorAll('[data-close]').forEach(b=>b.addEventListener('click',()=>closeModal(b.dataset.close)));
document.getElementById('open-mural')?.addEventListener('click',()=>openModal('modal-mural'));
document.getElementById('open-rsvp')?.addEventListener('click',()=>openModal('modal-rsvp'));

/* ---------- Enviar mural (apenas coluna 'mensagem') ---------- */
document.getElementById('mural-send')?.addEventListener('click', async ()=>{
  if(!supaReady){ alert('Mural iniciando, tente novamente.'); return; }
  const t = document.getElementById('mural-input').value.trim();
  const err = document.getElementById('mural-error');
  if(t.length<2){ err.textContent="Escreva ao menos 2 caracteres üôÇ"; err.style.display='block'; return; }
  err.style.display='none';
  try{
    const { error } = await supabaseClient.from('messages').insert({ mensagem: t });
    if(error) throw error;
    document.getElementById('mural-input').value='';
    closeModal('modal-mural');
    loadMural(true);
  }catch(e){
    err.textContent="N√£o foi poss√≠vel publicar agora. " + (e?.message || "");
    err.style.display='block';
  }
});

/* ---------- RSVP (WhatsApp) ‚Äì mensagens no formato solicitado ---------- */
(function(){
  const yn = document.getElementById('yn');
  const extra = document.getElementById('rsvp-extra');
  let going = null;

  yn.querySelectorAll('.opt').forEach(opt=>{
    opt.addEventListener('click',()=>{
      yn.querySelectorAll('.opt').forEach(o=>o.classList.remove('active'));
      opt.classList.add('active');
      going = opt.dataset.val;
      extra.classList.toggle('hide', going!=='sim');
    });
  });

  function wppLink(txt){
    const phone = '5521993835163';
    return `https://wa.me/${phone}?text=${encodeURIComponent(txt)}`;
  }

  document.getElementById('rsvp-send')?.addEventListener('click',()=>{
    const nome = document.getElementById('rsvp-nome').value.trim();
    if(!nome){ alert('Informe seu nome.'); return; }
    if(!going){ alert('Escolha se voc√™ vai ou n√£o.'); return; }

    if(going==='nao'){
      const msg = `Ol√°! Infelizmente n√£o poderei comparecer ao anivers√°rio da Isabella üòî

‚Ä¢ Nome: ${nome}`;
      window.open(wppLink(msg),'_blank','noopener');
      closeModal('modal-rsvp');
      return;
    }

    const acomp  = (document.getElementById('rsvp-acompanha').value.trim() || '‚Äî');
    const qtd    = (document.getElementById('rsvp-qtd').value.trim() || '‚Äî');
    const idades = (document.getElementById('rsvp-idades').value.trim() || '‚Äî');

    const msg = `Ol√°! Confirmo minha presen√ßa no anivers√°rio da Isabella üéâ

‚Ä¢ Nome: ${nome}
‚Ä¢ Acompanhante: ${acomp}
‚Ä¢ Qtd Filhos: ${qtd}
‚Ä¢ Idade dos Filhos: ${idades}`;

    window.open(wppLink(msg),'_blank','noopener');
    closeModal('modal-rsvp');
  });
})();

/* ---------- Contagem regressiva (meses:dias:horas) ---------- */
(function(){
  const EVENT_ISO = '2025-11-16T10:30:00'; // hor√°rio local
  const target = new Date(EVENT_ISO);

  const elM = document.getElementById('cd-months');
  const elD = document.getElementById('cd-days');
  const elH = document.getElementById('cd-hours');
  const elStatus = document.getElementById('cd-status');

  function pad(n){ return String(n).padStart(2,'0'); }

  function addMonths(date, n){
    const d = new Date(date);
    const day = d.getDate();
    d.setDate(1);
    d.setMonth(d.getMonth()+n);
    const last = new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();
    d.setDate(Math.min(day, last));
    return d;
  }

  function tick(){
    const now = new Date();
    if(now >= target){
      elM.textContent = '00'; elD.textContent = '00'; elH.textContent = '00';
      if(elStatus) elStatus.textContent = '√â hoje! üéâ';
      return;
    }
    let anchor = new Date(now);
    anchor.setSeconds(0,0);

    let months = 0;
    while(addMonths(anchor,1) <= target){
      anchor = addMonths(anchor,1);
      months++;
      if(months>120) break;
    }

    let rem = target - anchor;
    const days = Math.floor(rem/86400000); rem -= days*86400000;
    const hours = Math.floor(rem/3600000);

    elM.textContent = pad(months);
    elD.textContent = pad(days);
    elH.textContent = pad(hours);
  }

  tick();
  setInterval(tick, 60000);
})();

/* ---------- Tempo (Open-Meteo) ‚Äî clean + ‚ÄúM√≠n ‚Ä¢ M√°x‚Äù em roxo, n√∫meros com sombra e emoji autom√°tico ---------- */
(function(){
  const EVENT_DATE = '2025-11-16';
  const LAT=-22.606, LON=-43.490, TZ='America/Sao_Paulo';
  const elDate=document.getElementById('weatherDate'), elText=document.getElementById('weatherText'), elSrc=document.getElementById('weatherSource');

  // Data exibida (ex.: "16 de novembro")
  elDate.textContent = new Intl.DateTimeFormat('pt-BR',{day:'2-digit',month:'long'}).format(new Date(EVENT_DATE+'T12:00:00'));

  function daysTo(iso){
    const t=new Date(); t.setHours(0,0,0,0);
    const e=new Date(iso+'T00:00:00');
    return Math.round((e-t)/86400000);
  }
  const dLeft=daysTo(EVENT_DATE);

  async function daily(){
    const u=new URL('https://api.open-meteo.com/v1/forecast');
    u.search=new URLSearchParams({
      latitude:LAT, longitude:LON, timezone:TZ,
      daily:'temperature_2m_max,temperature_2m_min,precipitation_probability_mean',
      start_date:EVENT_DATE, end_date:EVENT_DATE
    });
    const r=await fetch(u); if(!r.ok) throw 0; return r.json();
  }
  async function clim(){
    const u=new URL('https://climate-api.open-meteo.com/v1/climate');
    u.search=new URLSearchParams({
      latitude:LAT, longitude:LON, start_year:1991, end_year:2020, models:'ERA5',
      monthly:'temperature_2m_max_mean,temperature_2m_min_mean,precipitation_probability_mean',
      month:11
    });
    const r=await fetch(u); if(!r.ok) throw 0; return r.json();
  }
  function srcStamp(){
    const now=new Date();
    const stamp=new Intl.DateTimeFormat('pt-BR',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit',timeZone:TZ}).format(now).replace('.','');
    elSrc.innerHTML=`Fonte: <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo</a> ‚Ä¢ Atualizado em ${stamp} (BRT)`;
  }

  function render(tmin, tmax, p){
    // Emoji autom√°tico: ‚òÄÔ∏è (<20%), üå•Ô∏è (20‚Äì59%), üåßÔ∏è (>=60%)
    let emoji='‚òÄÔ∏è';
    if(typeof p==='number'){
      if(p>=60) emoji='üåßÔ∏è';
      else if(p>=20) emoji='üå•Ô∏è';
    }
    elText.innerHTML = `
      <span class="wx-emoji">${emoji}</span>
      <span class="temp-highlight">M√≠n <span class="num">${Math.round(tmin)}¬∞</span> ‚Ä¢ M√°x <span class="num">${Math.round(tmax)}¬∞</span></span>
    `;
  }

  (async()=>{
    try{
      if(dLeft>=0 && dLeft<=16){
        const d=await daily();
        const tmax=d.daily.temperature_2m_max?.[0];
        const tmin=d.daily.temperature_2m_min?.[0];
        const p=d.daily.precipitation_probability_mean?.[0];
        render(tmin, tmax, p);
      }else{
        const c=await clim(); const m=c.monthly||};
        const tmax=m.temperature_2m_max_mean?.[0] ?? 27;
        const tmin=m.temperature_2m_min_mean?.[0] ?? 20;
        render(tmin, tmax, null);
      }
    }catch(e){
      // Fallback est√°tico
      render(20, 27, null);
    }finally{
      srcStamp();
    }
  })();
})();
</script>
</body>
</html>
