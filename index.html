<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Festa da Isabella</title>
<style>
  :root{
    --roxo:#5b3fa2;
    --roxo-esc:#493183;
    --roxo-cl:#f1eaff;
    --bg:#fdfdfe;
    --txt:#333;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;line-height:1.5;background:var(--bg);color:var(--txt)}
  a{color:var(--roxo);text-decoration:none}
  .container{max-width:960px;margin:0 auto;padding:20px}

  /* Overlay de boas‚Äëvindas (solicitar m√∫sica) */
  .welcome-overlay{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(4px)}
  .welcome-card{width:min(92vw,520px);background:#fff;border-radius:16px;padding:28px;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,.2)}
  .welcome-card h2{font-size:1.6rem;color:var(--roxo);margin-bottom:8px}
  .welcome-card p{color:#444;margin-bottom:18px}
  .welcome-actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}

  /* Hero */
  .hero{position:relative;background:url('hero.jpg') center/cover no-repeat;height:60vh;min-height:320px;display:flex;align-items:center;justify-content:center;color:#fff;text-align:center}
  .hero::before{content:"";position:absolute;inset:0;background:rgba(0,0,0,.2)}
  .hero h1{position:relative;font-size:2.5rem;margin-bottom:.5rem;font-weight:700}
  .hero p{position:relative;font-size:1.2rem;margin-bottom:0}

  /* Cards (padding/margem uniformes ‚Äì mais leves) */
  .card{
    background:rgba(255,255,255,.8);
    backdrop-filter:blur(8px);
    border-radius:12px;
    padding:18px;            /* ‚Üì antes era 20 */
    margin:18px 0;           /* ‚Üì antes era 20 */
    box-shadow:0 4px 6px rgba(0,0,0,.05);
    text-align:center
  }
  .card h2{color:var(--roxo);font-weight:800;letter-spacing:-0.02em;font-size:clamp(1.4rem,1.2rem + 1vw,1.8rem);margin-bottom:10px}
  .card p{margin:8px auto 0;max-width:60ch;color:#4a4a4a}

  .details-list{
    list-style:none;display:grid;grid-template-columns:1fr;gap:.5rem;justify-items:center;
    margin-bottom:10px; /* respiro antes dos bot√µes */
  }
  .details-item{display:flex;align-items:center;gap:.5rem;font-size:1rem;justify-content:center}
  .details-item .icon{display:inline-flex;align-items:center;justify-content:center;width:1.4em;height:1.4em;font-size:1.2rem;line-height:1;transform:translateY(1px);color:var(--roxo)}

  /* Bot√µes ‚Äì altura/fonte menores para todos */
  .button-row{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px;justify-content:center} /* gap/mt menores */
  .btn{
    display:inline-block;padding:10px 16px; /* menor */
    border-radius:10px; /* menor */
    font-weight:700;cursor:pointer;transition:background .2s, transform .05s;text-align:center;border:none;
    font-size:1rem;     /* menor */
  }
  .btn:active{transform:translateY(1px)}
  .btn-primary{background:var(--roxo);color:#fff}
  .btn-primary:hover{background:var(--roxo-esc)}
  .btn-secondary{background:var(--roxo-cl);color:var(--roxo)}
  .btn-secondary:hover{filter:brightness(.97)}

  /* √Ålbum (levemente menor) */
  .album-preview{display:grid;grid-template-columns: repeat(3,1fr);gap:10px;justify-items:center;margin:4px auto 10px}
  .album-preview .frame{position:relative;overflow:hidden;border-radius:12px;aspect-ratio:1/1;width:110px; /* 120 ‚Üí 110 */ box-shadow:0 4px 6px rgba(0,0,0,.1);transform:rotate(var(--tilt,0deg));transition:transform .5s ease}
  .album-preview .frame img{width:100%;height:100%;display:block;object-fit:cover;object-position:center}

  /* Ajustes de espa√ßamento para cards "limpos" (sem subt√≠tulo) */
  .card--tight .album-preview{margin-top:6px}
  .card--tight .playlist-iframe{margin-top:6px}
  .card--tight .map-container{margin-top:6px}

  /* Responsivo */
  @media (min-width:600px){.details-list{grid-template-columns:repeat(2,1fr)}}
  @media (min-width:900px){.details-list{grid-template-columns:repeat(3,1fr)}}

  /* Mapa + Playlist */
  .map-container{width:100%;height:300px;border-radius:12px;overflow:hidden}
  iframe{width:100%;height:100%;border:0}
  .playlist-iframe{width:100%;max-width:600px;height:180px;border-radius:12px;overflow:hidden;border:none}

  /* Tempo (centralizado) */
  .weather-wrapper{display:flex;justify-content:center;margin:18px 0 80px}
  .weather-card{width:min(680px,92vw);padding:20px;border-radius:12px;background:rgba(255,255,255,.8);backdrop-filter:blur(8px);box-shadow:0 4px 6px rgba(0,0,0,.05);color:var(--txt);text-align:center}
  .weather-app{color:var(--roxo);font-weight:800;letter-spacing:-0.02em;}
  .weather-date{margin-top:6px;font-size:1rem;color:#666}
  .weather-text{margin:12px auto 6px;font-size:1rem;line-height:1.5;max-width:60ch;color:#4a4a4a}
  .weather-source{margin-top:6px;font-size:.9rem;color:#7a7a7a}
  .weather-source a{color:var(--roxo);text-decoration:none}
  .weather-source a:hover{text-decoration:underline}

  /* Marca d‚Äô√°gua */
  footer{position:fixed;bottom:20px;width:100%;text-align:center;font-size:12px;color:#999;}

  /* ======= MURAL ======= */
  .mural-viewport{position:relative;min-height:72px; /* menor */ margin:10px auto 6px;width:min(680px,92vw)}
  .mural-msg{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    padding:10px 12px;background:#fff;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06);
    opacity:0;transform:translateY(4px);transition:opacity .6s ease, transform .6s ease;color:#3f3f3f
  }
  .mural-msg.active{opacity:1;transform:translateY(0)}
  .mural-empty{color:#7a7a7a}

  /* Modal base */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:10000;padding:18px}
  .modal.open{display:flex}
  .modal-card{width:min(92vw,560px);background:#fff;border-radius:16px;padding:20px;box-shadow:0 12px 28px rgba(0,0,0,.25)}
  .modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
  .modal-title{font-size:1.5rem;font-weight:800;color:var(--roxo)}
  .modal-close{background:transparent;border:none;font-size:1.4rem;cursor:pointer;color:#777}
  .modal p.helper{color:#555;margin-bottom:10px}

  .form-grid{display:grid;gap:10px}
  .field{display:flex;flex-direction:column;gap:6px;text-align:left}
  .field label{font-weight:600;color:#444}
  .field input,.field select,.field textarea{
    border:2px solid #eee;background:#f7f2ff4f;border-radius:12px;padding:10px 12px;font-size:1rem;outline:none
  }
  .field input:focus,.field select:focus,.field textarea:focus{border-color:#d6c7ff;background:#fff}
  .row-actions{display:flex;gap:10px;justify-content:flex-start;margin-top:4px}
  .btn-ghost{background:#efe8ff;color:var(--roxo);border:none;padding:9px 14px;border-radius:999px;font-weight:700}
  .hidden{display:none}

  /* dois bot√µes lado a lado (quando couber) com respiro extra */
  .info-actions{display:grid;grid-template-columns:1fr;gap:10px;margin-top:6px}
  @media (min-width:560px){ .info-actions{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>

  <!-- Tela de Boas‚Äëvindas -->
  <div class="welcome-overlay" id="welcome">
    <div class="welcome-card">
      <h2>Bem‚Äëvindo(a) √† Festa da Isabella! üé∂</h2>
      <p>Toque a m√∫sica para entrar no clima da celebra√ß√£o.</p>
      <div class="welcome-actions">
        <button class="btn btn-primary" id="start-music">Entrar e tocar playlist</button>
        <button class="btn btn-secondary" id="enter-silent">Entrar sem m√∫sica</button>
      </div>
    </div>
  </div>

  <!-- √Åudio de pr√©via (oculto) -->
  <audio id="preview-audio" preload="auto" loop>
    <source src="assets/kids-children-baby-music-363272.mp3" type="audio/mpeg">
  </audio>

  <header class="hero">
    <div>
      <h1>Festa da Isabella</h1>
      <p>Celebrando seu 1¬∫ anivers√°rio</p>
    </div>
  </header>

  <main class="container">

    <!-- Boas‚Äëvindas -->
    <section class="card intro-card">
      <h2>Boas‚Äëvindas</h2>
      <p>
        √â com muita alegria que convidamos voc√™ para celebrar o 1¬∫ anivers√°rio da nossa princesa Isabella! üéâüíñ<br>
        Ser√° um momento especial para reunirmos fam√≠lia e amigos, com muita divers√£o, m√∫sica e boas lembran√ßas.<br>
        Esperamos voc√™ para comemorar conosco esse dia t√£o importante! ü•≥‚ú®
      </p>
    </section>

    <!-- Mural -->
    <section class="card" id="mural-card">
      <h2>Mural üíå</h2>
      <div class="mural-viewport">
        <div class="mural-msg mural-empty active" id="muralEmpty">Seja o primeiro a deixar um recado üíú</div>
      </div>
      <div class="button-row"><button class="btn btn-primary" id="openMural">Deixar mensagem üíå</button></div>
    </section>

    <!-- Informa√ß√µes -->
    <section class="card">
      <h2>Informa√ß√µes da festa</h2>
      <ul class="details-list">
        <li class="details-item"><span class="icon">üìÖ</span>22 de novembro de 2025, 14h00‚Äì18h00</li>
        <li class="details-item">
          <span class="icon">üìç</span>
          S√≠tio Verdes Encantos ‚Äì Estr Zumbi dos Palmares, 286 - Tingu√°, Nova Igua√ßu - RJ, 26063-355, Brasil
        </li>
        <li class="details-item"><span class="icon">üëó</span>Traje: casual festivo</li>
      </ul>
      <div class="info-actions">
        <button class="btn btn-primary" id="openRsvp">Confirmar presen√ßa</button>
        <a class="btn btn-secondary" href="festa_da_isabella.ics" download>Adicionar ao calend√°rio</a>
      </div>
    </section>

    <!-- √Ålbum -->
    <section class="card card--tight">
      <h2>√Ålbum de fotos</h2>
      <div class="album-preview">
        <div class="frame"><img alt=""></div><div class="frame"><img alt=""></div><div class="frame"><img alt=""></div>
        <div class="frame"><img alt=""></div><div class="frame"><img alt=""></div><div class="frame"><img alt=""></div>
      </div>
      <div class="button-row" style="margin-top:8px">
        <a class="btn btn-secondary" href="https://www.icloud.com/sharedalbum/#B2RJEsNWnGMlnHa" target="_blank" rel="noopener">Abrir √°lbum completo</a>
      </div>
    </section>

    <!-- Mapa -->
    <section class="card card--tight">
      <h2>Como chegar</h2>
      <div class="map-container">
        <iframe src="https://maps.google.com/maps?q=S%C3%ADtio%20Verdes%20Encantos%20-%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil&t=m&z=15&ie=UTF8&iwloc=&output=embed" allowfullscreen loading="lazy"></iframe>
      </div>
      <div class="button-row">
        <a class="btn btn-secondary" href="https://www.google.com/maps/dir/?api=1&destination=S%C3%ADtio%20Verdes%20Encantos%20-%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil" target="_blank" rel="noopener">Tra√ßar rota</a>
        <a class="btn btn-secondary" href="https://www.google.com/maps/search/?api=1&query=S%C3%ADtio%20Verdes%20Encantos%20Estr%20Zumbi%20dos%20Palmares%2C%20286%20-%20Tingu%C3%A1%2C%20Nova%20Igua%C3%A7u%20-%20RJ%2C%2026063-355%2C%20Brasil" target="_blank" rel="noopener">Abrir no Google Maps</a>
      </div>
    </section>

    <!-- Presentes -->
    <section class="card">
      <h2>Sugest√£o de presentes üíù</h2>
      <ul class="details-list">
        <li class="details-item"><span class="icon">üß∏</span>Brinquedos educativos</li>
        <li class="details-item"><span class="icon">üëó</span>Roupas tamanho 2 anos (cores suaves)</li>
        <li class="details-item"><span class="icon">ü©∞</span>Cal√ßados a partir do tamanho 22</li>
      </ul>
      <div class="button-row">
        <a class="btn btn-secondary" target="_blank" rel="noopener" href="https://wa.me/5521993835163?text=Oi%2C%20tenho%20uma%20d%C3%BAvida%20sobre%20o%20presente%20da%20Isabella">D√∫vidas sobre o presente</a>
      </div>
    </section>

    <!-- Playlist Apple -->
    <section class="card card--tight" id="playlist-section">
      <h2>Playlist da festa</h2>
      <iframe class="playlist-iframe" allow="autoplay *; encrypted-media *; fullscreen *"
              sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"
              src="https://embed.music.apple.com/br/playlist/playlist-festa-da-isabella/pl.u-MRjJtWNaq0M" title="Playlist da Festa"></iframe>
    </section>

    <!-- Tempo -->
    <section class="weather-wrapper">
      <div class="weather-card">
        <h2 class="weather-app">Tempo</h2>
        <div class="weather-date" id="weatherDate">‚Äî</div>
        <div class="weather-text" id="weatherText">Carregando‚Ä¶</div>
        <div class="weather-source" id="weatherSource">Fonte: ‚Äî</div>
      </div>
    </section>
  </main>

  <footer>¬© 2025 Hugo Mattos. Todos os direitos reservados.</footer>

  <!-- MODAL: Mural -->
  <div class="modal" id="muralModal">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Deixar mensagem üíå</div>
        <button class="modal-close" data-close="muralModal">‚úï</button>
      </div>
      <p class="helper">M√°x. 140 caracteres. Se quiser, assine no final (ex.: ‚Äú‚Äî Fam√≠lia Silva‚Äù).</p>
      <div class="form-grid">
        <div class="field">
          <label for="muralText">Mensagem *</label>
          <textarea id="muralText" rows="3" maxlength="140" placeholder="Ansioso para comemorar junto com voc√™s! üéâ" required></textarea>
        </div>
        <div class="row-actions">
          <button class="btn btn-primary" id="publishMsg">Publicar</button>
          <button class="btn btn-ghost" data-close="muralModal">Cancelar</button>
        </div>
        <div id="muralErr" class="field" style="color:#a33;display:none">N√£o foi poss√≠vel publicar agora. Tente de novo.</div>
      </div>
    </div>
  </div>

  <!-- MODAL: RSVP -->
  <div class="modal" id="rsvpModal">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Confirma√ß√£o de presen√ßa ‚ú®</div>
        <button class="modal-close" data-close="rsvpModal">‚úï</button>
      </div>
      <p class="helper">Preencha seus dados e envie ‚Äî abriremos o WhatsApp com a mensagem pronta.</p>

      <div class="form-grid" id="rsvpForm">
        <div class="field">
          <label for="nome">Seu nome *</label>
          <input id="nome" type="text" placeholder="Nome completo" required>
        </div>

        <div class="field">
          <label>Voc√™ vai?</label>
          <div class="row-actions">
            <button type="button" class="btn btn-secondary" data-rsvp="sim">Sim</button>
            <button type="button" class="btn btn-secondary" data-rsvp="nao">N√£o</button>
          </div>
        </div>

        <div id="rsvpExtras" class="hidden">
          <div class="field">
            <label for="acompanha">Acompanhante</label>
            <input id="acompanha" type="text" placeholder="Nome do(a) acompanhante (se houver)">
          </div>
          <div class="field">
            <label for="qtd">Qtd. filhos</label>
            <input id="qtd" type="number" min="0" value="0">
          </div>
          <div class="field">
            <label for="idades">Idades dos filhos</label>
            <input id="idades" type="text" placeholder="Ex.: 5, 2">
          </div>
        </div>

        <div class="row-actions" style="margin-top:8px">
          <button class="btn btn-primary" id="sendRsvp">Enviar</button>
          <button class="btn btn-ghost" data-close="rsvpModal">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ===== Supabase (mural) ===== */
const SUPABASE_URL = 'https://kfoousycrqscvhivhmxu.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtmb291c3ljcnFzY3ZoaXZobXh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMDI1MTcsImV4cCI6MjA3MDY3ODUxN30.e55uMlW4mBmQjvG0U9WaEyqLPvjL9US3LP_9IvNTLVQ';
const $ = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

document.addEventListener('DOMContentLoaded', function () {
  /* √Ålbum */
  const previewImages = [
    'album2/IMG_5139.jpeg','album2/IMG_5010.jpeg','album2/IMG_4772.jpeg',
    'album2/IMG_4765.jpeg','album2/IMG_4639.jpeg','album2/IMG_6911.jpeg',
    'album2/IMG_4450.jpeg','album2/IMG_4352.jpeg','album2/IMG_3056.jpeg',
    'album2/96f8947a-603d-43c7-b498-292922662164.jpeg'
  ];
  const frames = $$('.album-preview .frame');
  function shuffle(a){const b=a.slice();for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]]}return b;}
  function fillPreview(){
    const imgs = shuffle(previewImages);
    frames.forEach((frame, idx) => {
      const img = $('img', frame);
      img.src = imgs[idx % imgs.length];
      const angle = (Math.random()*10 - 5);
      frame.style.setProperty('--tilt', angle + 'deg');
    });
  }
  fillPreview();
  setInterval(fillPreview, 8000);

  /* M√∫sica */
  const welcome = $('#welcome');
  const startBtn = $('#start-music');
  const enterSilent = $('#enter-silent');
  const audio = $('#preview-audio');
  function closeWelcome(){ if (welcome) welcome.style.display='none'; }
  startBtn?.addEventListener('click', async () => { try{ await audio.play(); }catch(e){} closeWelcome(); });
  enterSilent?.addEventListener('click', () => { closeWelcome(); });

  /* Mural */
  const viewport = $('.mural-viewport');
  const empty = $('#muralEmpty');
  let msgs = [], idx = 0, rotTimer = null;

  async function fetchMessages(){
    try{
      const url = new URL(SUPABASE_URL + '/rest/v1/messages');
      url.search = new URLSearchParams({select:'id,created_at,text', order:'created_at.desc', limit:'20'});
      const r = await fetch(url, { headers:{apikey:SUPABASE_KEY, Authorization:'Bearer '+SUPABASE_KEY} });
      if(!r.ok) throw new Error('fetch mural');
      msgs = await r.json();
      startRotation();
    }catch(e){
      viewport.innerHTML = '<div class="mural-msg active">N√£o foi poss√≠vel carregar as mensagens agora.</div>';
    }
  }
  function renderOne(txt, activate=true){
    const div = document.createElement('div');
    div.className = 'mural-msg'; div.textContent = txt;
    viewport.appendChild(div);
    requestAnimationFrame(()=>{ if(activate) div.classList.add('active'); });
    return div;
  }
  function startRotation(){
    viewport.innerHTML = '';
    if(!msgs || msgs.length===0){ viewport.appendChild(empty); empty.classList.add('active'); return; }
    idx = 0; renderOne(msgs[idx].text);
    if(rotTimer) clearInterval(rotTimer);
    rotTimer = setInterval(()=>{
      const current = $$('.mural-msg', viewport).pop();
      if(current){ current.classList.remove('active'); setTimeout(()=>current.remove(),600); }
      idx = (idx+1) % msgs.length;
      renderOne(msgs[idx].text, true);
    }, 5000);
  }
  fetchMessages();

  $('#openMural')?.addEventListener('click', ()=> $('#muralModal').classList.add('open'));
  $$('[data-close]').forEach(btn=> btn.addEventListener('click', ()=> $('#'+btn.dataset.close).classList.remove('open')));

  $('#publishMsg')?.addEventListener('click', async ()=>{
    const txt = $('#muralText').value.trim();
    $('#muralErr').style.display = 'none';
    if(!txt){ $('#muralErr').style.display='block'; return; }
    try{
      const r = await fetch(SUPABASE_URL + '/rest/v1/messages',{
        method:'POST',
        headers:{'Content-Type':'application/json', apikey:SUPABASE_KEY, Authorization:'Bearer '+SUPABASE_KEY, Prefer:'return=representation'},
        body: JSON.stringify({ text: txt })
      });
      if(!r.ok) throw new Error('post');
      const saved = await r.json();
      msgs.unshift(saved[0]); $('#muralModal').classList.remove('open'); $('#muralText').value=''; startRotation();
    }catch(e){ $('#muralErr').style.display='block'; }
  });

  /* RSVP (WhatsApp) */
  const rsvpModal = $('#rsvpModal');
  $('#openRsvp')?.addEventListener('click', ()=> rsvpModal.classList.add('open'));
  let vai = null;
  $$('[data-rsvp]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      vai = btn.dataset.rsvp;
      $$('[data-rsvp]').forEach(b=>b.classList.remove('btn-primary'));
      btn.classList.add('btn-primary');
      $('#rsvpExtras').classList.toggle('hidden', vai!=='sim');
    });
  });
  $('#sendRsvp')?.addEventListener('click', ()=>{
    const nome = $('#nome').value.trim();
    if(!nome || !vai){ alert('Informe seu nome e selecione se voc√™ vai ou n√£o.'); return; }
    const acomp = $('#acompanha').value.trim();
    const qtd = $('#qtd').value.trim();
    const idades = $('#idades').value.trim();
    let txt = `Ol√°! Sou ${nome}. `;
    txt += vai==='sim' ? 'Confirmo minha presen√ßa' : 'N√£o poderei ir';
    if(vai==='sim'){
      if(acomp) txt += ` com ${acomp}`;
      if(qtd && Number(qtd)>0){ txt += ` e ${qtd} filho(s)`; if(idades) txt += ` (idades: ${idades})`; }
    }
    txt += ' na Festa da Isabella.';
    const url = `https://wa.me/5521993835163?text=${encodeURIComponent(txt)}`;
    window.open(url,'_blank','noopener');
    rsvpModal.classList.remove('open');
  });

});

/* Tempo */
(function(){
  const EVENT_DATE_DEFAULT = '2025-11-22';
  const LAT = -22.606, LON = -43.490;
  const TZ = 'America/Sao_Paulo';
  const qs = new URLSearchParams(location.search);
  const EVENT_DATE = qs.get('data') || EVENT_DATE_DEFAULT;

  const elDate = document.querySelector('#weatherDate');
  elDate.textContent = new Intl.DateTimeFormat('pt-BR',{ day:'2-digit', month:'long'}).format(new Date(EVENT_DATE+'T12:00:00'));

  function daysTo(dateIso){
    const today = new Date(); today.setHours(0,0,0,0);
    const ev = new Date(dateIso+'T00:00:00');
    return Math.round((ev - today)/86400000);
  }
  const dleft = daysTo(EVENT_DATE);
  const elText = document.querySelector('#weatherText');
  const elSource = document.querySelector('#weatherSource');
  function setSourceStamp(name){
    const now = new Date();
    const fmt = new Intl.DateTimeFormat('pt-BR',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit',timeZone:'America/Sao_Paulo'}).format(now).replace('.','');
    elSource.innerHTML = `Fonte: <a href="https://open-meteo.com/" target="_blank" rel="noopener">${name}</a> ‚Ä¢ Atualizado em ${fmt} (BRT)`;
  }
  async function getDaily(){ const u=new URL('https://api.open-meteo.com/v1/forecast'); u.search=new URLSearchParams({latitude:LAT,longitude:LON,timezone:TZ,daily:'temperature_2m_max,temperature_2m_min,precipitation_probability_mean',start_date:EVENT_DATE,end_date:EVENT_DATE}); const r=await fetch(u); if(!r.ok) throw 0; return r.json(); }
  async function getClim(m){ const u=new URL('https://climate-api.open-meteo.com/v1/climate'); u.search=new URLSearchParams({latitude:LAT,longitude:LON,start_year:1991,end_year:2020,models:'ERA5',monthly:'temperature_2m_max_mean,temperature_2m_min_mean,precipitation_probability_mean',month:m}); const r=await fetch(u); if(!r.ok) throw 0; return r.json(); }

  (async ()=>{ try{
    if(dleft>=0 && dleft<=16){
      const d=await getDaily(); const tmax=Math.round(d.daily.temperature_2m_max[0]); const tmin=Math.round(d.daily.temperature_2m_min[0]); const p=d.daily.precipitation_probability_mean?.[0];
      elText.textContent = typeof p==='number'?`Previs√£o: entre ${tmin}¬∞ e ${tmax}¬∞, chance de chuva ${p}%`:`Previs√£o: entre ${tmin}¬∞ e ${tmax}¬∞`; setSourceStamp('Open‚ÄëMeteo (previs√£o di√°ria)');
    }else{
      const m=Number(EVENT_DATE.split('-')[1]); const c=await getClim(m); const mm=c.monthly||{}; const tmax=Math.round(mm.temperature_2m_max_mean?.[0]??27), tmin=Math.round(mm.temperature_2m_min_mean?.[0]??20);
      elText.textContent=`Nesta √©poca do ano, a temperatura costuma variar entre ${tmin}¬∞ e ${tmax}¬∞.`; setSourceStamp('Open‚ÄëMeteo (climatologia 1991‚Äì2020)');
    }
  }catch{ elText.textContent='Nesta √©poca do ano, a temperatura costuma variar entre 20¬∞ e 27¬∞.'; setSourceStamp('Open‚ÄëMeteo'); }})();
})();
</script>
</body>
</html>
