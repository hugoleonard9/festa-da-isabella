<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Confirmação de presença — Festa da Isabella</title>
<style>
  :root{ --roxo:#5b3fa2; --roxo-clar:#f1eaff; }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;
    background:#f7f7fb;color:#333;line-height:1.5;padding:20px
  }
  .container{max-width:720px;margin:0 auto}
  .card{
    background:#fff;border-radius:16px;padding:22px;margin:14px 0;
    box-shadow:0 6px 20px rgba(0,0,0,.06)
  }
  h1{font-size:1.8rem;margin-bottom:8px;color:var(--roxo)}
  p.lead{margin-bottom:14px;color:#555}
  .choices{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 6px}
  .btn{
    border:none;cursor:pointer;border-radius:10px;padding:12px 18px;font-weight:600;
    background:var(--roxo-clar);color:var(--roxo);transition:.2s
  }
  .btn:hover{filter:brightness(.95)}
  .btn-primary{background:var(--roxo);color:#fff}
  .hidden{display:none}
  label{display:block;margin-top:12px;margin-bottom:6px;font-weight:600}
  input,textarea{
    width:100%;padding:12px;border:1px solid #e5e5ef;border-radius:10px;background:#fcfcff
  }
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:640px){.row{grid-template-columns:1fr}}
  .kids{margin-top:10px}
  .kid-row{display:grid;grid-template-columns:1fr 120px auto;gap:10px;margin-top:8px}
  .kid-row .remove{background:#fff;border:1px solid #eee;border-radius:10px;padding:0 10px;cursor:pointer}
  .muted{color:#777;font-size:.95rem}
  .success{padding:14px;border-radius:10px;background:#ecfff2;color:#1d7c3e;margin-top:12px}
  .error{padding:14px;border-radius:10px;background:#fff1f1;color:#a32020;margin-top:12px}
  .footnote{margin-top:10px;font-size:.9rem;color:#777}
</style>
</head>
<body>
  <main class="container">
    <section class="card">
      <h1>Confirmação de presença ✨</h1>
      <p class="lead">
        Olá! Este espaço é exclusivo para sua confirmação de presença no aniversário da Isabella.
        Seu nome já está na lista oficial — aqui é apenas para registrar seus dados, o nome do seu acompanhante e dos seus filhos.
      </p>

      <!-- Etapa 1: escolha -->
      <div id="step-choice">
        <p class="muted">Como você confirma?</p>
        <div class="choices">
          <button class="btn btn-primary" data-rsvp="Sim">Sim</button>
          <button class="btn" data-rsvp="Não">Não</button>
        </div>
      </div>

      <!-- Etapa 2a: formulário para "Sim" -->
      <form id="form-sim" class="hidden">
        <input type="hidden" name="rsvp" value="Sim">
        <label for="nome">Seu nome *</label>
        <input id="nome" name="nome" required placeholder="Ex.: João Silva">

        <div class="row">
          <div>
            <label for="idade">Sua idade</label>
            <input id="idade" name="idade" type="number" min="0" placeholder="Ex.: 32">
          </div>
          <div>
            <label for="acompanhante">Nome do acompanhante</label>
            <input id="acompanhante" name="acompanhante" placeholder="Se houver">
          </div>
        </div>

        <div class="kids">
          <label>Filhos (idade de cada)</label>
          <div id="kids-list"></div>
          <button type="button" id="add-kid" class="btn" style="margin-top:8px">+ Adicionar filho</button>
        </div>

        <label for="obs">Observações</label>
        <textarea id="obs" name="observacoes" rows="3" placeholder="Alergias, restrições, etc. (opcional)"></textarea>

        <button type="submit" class="btn btn-primary" style="margin-top:14px">Enviar confirmação</button>
        <div id="msg-sim" class="hidden"></div>
        <p class="footnote">Seus dados ficam visíveis apenas para os organizadores.</p>
      </form>

      <!-- Etapa 2b: envio rápido para "Não" -->
      <form id="form-nao" class="hidden">
        <input type="hidden" name="rsvp" value="Não">
        <label for="nome2">Seu nome *</label>
        <input id="nome2" name="nome" required placeholder="Ex.: João Silva">
        <label for="motivo">Mensagem (opcional)</label>
        <textarea id="motivo" name="observacoes" rows="3" placeholder="Se quiser, deixe um recado"></textarea>
        <button type="submit" class="btn btn-primary" style="margin-top:14px">Enviar</button>
        <div id="msg-nao" class="hidden"></div>
      </form>
    </section>
  </main>

<script>
  /* ====== CONFIG ====== */
  const SCRIPT_URL = 'COLE_AQUI_A_URL_DO_SEU_WEB_APP'; // Google Apps Script Web App (POST)
  const WHATSAPP   = '5521993835163';                  // só números, com DDI e DDD
  const EVENTO     = 'Festa da Isabella';

  /* ====== UI: fluxo ====== */
  const stepChoice = document.getElementById('step-choice');
  const formSim = document.getElementById('form-sim');
  const formNao = document.getElementById('form-nao');

  document.querySelectorAll('[data-rsvp]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const choice = btn.dataset.rsvp;
      stepChoice.classList.add('hidden');
      if(choice === 'Sim'){ formSim.classList.remove('hidden'); }
      else { formNao.classList.remove('hidden'); }
    });
  });

  /* ====== Filhos dinâmicos ====== */
  const kidsList = document.getElementById('kids-list');
  document.getElementById('add-kid').addEventListener('click', ()=>{
    const row = document.createElement('div');
    row.className = 'kid-row';
    row.innerHTML = `
      <input name="filho_nome[]" placeholder="Nome (opcional)">
      <input name="filho_idade[]" type="number" min="0" placeholder="Idade">
      <button type="button" class="remove">x</button>
    `;
    row.querySelector('.remove').addEventListener('click', ()=> row.remove());
    kidsList.appendChild(row);
  });

  /* ====== Helpers ====== */
  function toParams(obj){
    return new URLSearchParams(obj).toString();
  }
  function goWhatsApp(msg){
    const url = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
    window.location.href = url;
  }
  async function postForm(fd){
    if(!SCRIPT_URL || SCRIPT_URL.startsWith('COLE_AQUI')) return {status:'skip'};
    const res = await fetch(SCRIPT_URL,{method:'POST',body:fd});
    try { return await res.json(); } catch { return {status:'ok'} }
  }

  /* ====== Envio: SIM ====== */
  formSim.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const msgBox = document.getElementById('msg-sim');
    msgBox.className=''; msgBox.innerHTML='Enviando...';

    const data = new FormData(formSim);
    // serializar filhos
    const nomes = Array.from(document.getElementsByName('filho_nome[]')).map(i=>i.value.trim()).filter(Boolean);
    const idades= Array.from(document.getElementsByName('filho_idade[]')).map(i=>i.value.trim()).filter(Boolean);
    data.append('filhos_nomes', nomes.join(', '));
    data.append('filhos_idades', idades.join(', '));

    // mensagem do WhatsApp
    const nome = (data.get('nome')||'').trim();
    const acomp = (data.get('acompanhante')||'').trim();
    const kids  = idades.length ? idades.map((v,i)=> (nomes[i]? `${nomes[i]} (${v})` : `${v} anos`)).join(', ') : '—';
    const obs   = (data.get('observacoes')||'—').trim();

    const waMsg =
`${EVENTO} — Confirmação de presença
Nome: ${nome}
RSVP: SIM
Acompanhante: ${acomp || '—'}
Filhos: ${kids}
Observações: ${obs}`;

    try{
      await postForm(data);         // tenta salvar (se falhar, ainda assim segue)
      msgBox.className='success';
      msgBox.innerHTML='Confirmação registrada! Redirecionando para o WhatsApp...';
      setTimeout(()=> goWhatsApp(waMsg), 600);
    }catch(err){
      console.error(err);
      msgBox.className='error';
      msgBox.innerHTML='Não deu para salvar agora, mas vamos seguir para o WhatsApp.';
      setTimeout(()=> goWhatsApp(waMsg), 800);
    }
  });

  /* ====== Envio: NÃO ====== */
  formNao.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const msgBox = document.getElementById('msg-nao');
    msgBox.className=''; msgBox.innerHTML='Enviando...';

    const data = new FormData(formNao);
    const nome = (data.get('nome')||'').trim();
    const obs  = (data.get('observacoes')||'—').trim();

    const waMsg =
`${EVENTO} — Confirmação de presença
Nome: ${nome}
RSVP: NÃO
Mensagem: ${obs}`;

    try{
      await postForm(data);
      msgBox.className='success';
      msgBox.innerHTML='Resposta registrada. Levando ao WhatsApp...';
      setTimeout(()=> goWhatsApp(waMsg), 600);
    }catch(err){
      console.error(err);
      msgBox.className='error';
      msgBox.innerHTML='Falha ao salvar, mas vamos seguir para o WhatsApp.';
      setTimeout(()=> goWhatsApp(waMsg), 800);
    }
  });
</script>
</body>
</html>
